!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class i{constructor(e,t){this.head=e,this.tail=t}toString(){let e="";return this.head instanceof i?e+=`(${this.head.toString()})`:null===this.head?e+="()":e+=this.head,null===this.tail||(this.tail instanceof i?e+=` ${this.tail.toString()}`:e+=` . ${this.tail}`),e}}const a=(e,t)=>{let n=0;for(let i=0;i<e.length;i++)e[i]===t&&n++;return n};class o{constructor(e,t,n){this.type=e,this.value=t,this.positionInfo=n}}var l,s,r;!function(e){e[e.Bracket=0]="Bracket",e[e.Name=1]="Name",e[e.Dot=2]="Dot"}(l||(l={})),function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(s||(s={})),function(e){e[e.Paren=0]="Paren",e[e.Curly=1]="Curly",e[e.Square=2]="Square"}(r||(r={}));const d={"(":{shape:r.Paren,dir:s.Start},")":{shape:r.Paren,dir:s.End},"{":{shape:r.Curly,dir:s.Start},"}":{shape:r.Curly,dir:s.End},"[":{shape:r.Square,dir:s.Start},"]":{shape:r.Square,dir:s.End}},c=e=>{let t=[],n=[],r=new i,c=r,h=[],u=[];for(let r of function*(e){let t=0,n=1,i=0,s="";for(;t<e.length;)if(";"===e[t]){for(;"\n"!==e[++t];);t++}else if(" \n\r\t".includes(e[t]))""!==s?(yield new o(l.Name,s,{row:n,col:i}),i+=(s="").length):"\n"===e[t]&&(n++,i=1),i++,t++;else if("()[]{}".includes(e[t]))""!==s&&(yield new o(l.Name,s,{row:n,col:i}),i+=(s="").length),yield new o(l.Bracket,d[e[t++]],{row:n,col:i++});else if('"'===e[t]){""!==s&&(yield new o(l.Name,s,{row:n,col:i}),i+=(s="").length);let r=t+1;for(;r<e.length&&-1!==(r=e.indexOf('"',r));){let s=0;for(let t=1;"\\"===e[r-t];t++)s++;if(s%2==0){let s=e.substring(t,r+1);yield new o(l.Name,s,{row:n,col:i});let d=a(s,"\n");n+=d,d>0?i=s.length-s.lastIndexOf("\n"):i+=s.length,t=r+1;break}r++}if(-1===r)return}else""===s&&"."===e[t]?(yield new o(l.Dot,".",{row:n,col:i}),i++,t++):s+=e[t++];""!==s&&(yield new o(l.Name,s,{row:n,col:i}),i+=(s="").length)}(e))try{if(r.type===l.Bracket){let e=r.value;if(e.dir===s.Start){if(t.push(e.shape),h[h.length-1]===c){if(void 0===c.tail){c.tail=new i,n.push(c),c=c.tail;continue}u.push({pos:r.positionInfo,message:"A dot may only be followed by one value."}),h.pop()}void 0!==c.head&&(c.tail=new i,c=c.tail),c.head=new i,n.push(c),c=c.head}else{if(h.length>0&&h[h.length-1]===c&&(void 0===c.tail&&u.push({pos:r.positionInfo,message:"A dot must have a value following it."}),h.pop()),t[t.length-1]!==e.shape)for(u.push({pos:r.positionInfo,message:"Mismatched closing bracket."});t.length>0&&t.pop()!==e.shape;)h.length>0&&h[h.length-1]===c&&h.pop(),c.tail=c.tail||null,c=n.pop();if(void 0===c.head){const e=c;void 0===(c=n.pop())?u.push({pos:r.positionInfo,message:"Missing closing bracket."}):c.head===e?c.head=null:c.tail===e&&(c.tail=null)}else c.tail=c.tail||null,void 0===(c=n.pop())&&u.push({pos:r.positionInfo,message:"Missing closing bracket."})}}else if(r.type===l.Name){if(h.length>0&&h[h.length-1]===c){if(void 0===c.tail){c.tail=r.value;continue}u.push({pos:r.positionInfo,message:"A dot may only be followed by one value."}),h.pop()}void 0!==c.head&&(c.tail=new i,c=c.tail),c.head=r.value}else r.type===l.Dot&&(void 0===c.head?u.push({pos:r.positionInfo,message:"A dot must have a value preceeding it."}):h.push(c))}catch(e){console.error(e)}return c.tail=c.tail||null,u.length>0&&console.error(u.map(e=>`${e.pos.row}, ${e.pos.col}: ${e.message}`).join("\n")),r};var h=(()=>{const e="DOMContentLoaded",t=new WeakMap,n=[],i=e=>{do{if(e.nextSibling)return!0}while(e=e.parentNode);return!1},a=()=>{n.splice(0).forEach(e=>{!0!==t.get(e[0])&&(t.set(e[0],!0),e[0][e[1]]())})};document.addEventListener(e,a);class o extends HTMLElement{static withParsedCallback(o,l="parsed"){const{prototype:s}=o,{connectedCallback:r}=s,d=l+"Callback",c=(t,n,i,a)=>{n.disconnect(),i.removeEventListener(e,a),h(t)},h=e=>{n.length||requestAnimationFrame(a),n.push([e,d])};return Object.defineProperties(s,{connectedCallback:{configurable:!0,value(){if(r&&r.apply(this,arguments),d in this&&!t.has(this)){const n=this,{ownerDocument:a}=n;if(t.set(n,!1),"complete"===a.readyState||i(n))h(n);else{const t=()=>c(n,o,a,t);a.addEventListener(e,t);const o=new MutationObserver(()=>{i(n)&&c(n,o,a,t)});o.observe(n.parentNode,{childList:!0,subtree:!0})}}}},[l]:{configurable:!0,get(){return!0===t.get(this)}}}),o}}return o.withParsedCallback(o)})();class u{constructor(e,t){this.head=e,this.tail=t}}const p=e=>e instanceof u||e instanceof i;customElements.define("box-and-pointer",class extends h{constructor(){super(),this.visited=[],this._visitedElements=[],this.arrowBindings=[],this.slashes=[],this.shadow=this.attachShadow({mode:"open"}),this.shadow.innerHTML=""}async parsedCallback(){const e=this.generatePairsFromDOM(),t=[document.createElement("div")];t[0].classList.add("bp--row"),this.renderDiagram(null,t,0,e,[]);for(let e of t)this.shadow.appendChild(e);const n=jsPlumb.getInstance({Container:this.shadow,PaintStyle:{stroke:"black",strokeWidth:1.5,fill:"none"}}),i=[document.getElementById("box-and-pointer-style").cloneNode()];if(this.hasAttribute("stylesheet")){const e=document.createElement("link");e.rel="stylesheet",e.href=this.getAttribute("stylesheet"),i.push(e)}let a=i.length;for(let e of i)e.addEventListener("load",()=>0==--a&&n.ready(o));this.shadow.prepend(...i);const o=()=>{const e=[["Arrow",{location:1,width:8,length:12}],["Label",{location:0,cssClass:"bp--pointer-source"}]];for(let t of this.arrowBindings)"unknown"!==t[2]?("Top"===t[2]&&(t[1].style.width="2em"),n.connect({source:t[0],target:t[1],anchors:["Center",t[2]],overlays:e,connector:"Straight",endpoint:"Blank"}),"Top"===t[2]&&(t[1].style.width=null)):n.connect({source:t[0],target:t[1],anchors:["Center",["Continuous",{faces:["top","left","bottom"]}]],overlays:e,connector:[t[0].parentElement.parentElement===t[1].parentElement.parentElement?"StateMachine":"Bezier",{curviness:40,proximityLimit:0,margin:.01}],endpoint:"Blank"});for(let e of this.slashes)n.connect({source:e,target:e,anchors:["TopRight","BottomLeft"],connector:"Straight",endpoint:"Blank"});const t=this.getBoundingClientRect();for(const e of this.shadow.querySelectorAll(".jtk-overlay, .jtk-endpoint, .jtk-connector"))e.style.top=`${+e.style.top.slice(0,e.style.top.length-2)-t.top-window.scrollY}px`,e.style.left=`${+e.style.left.slice(0,e.style.left.length-2)-t.left-window.scrollX}px`;this.classList.add("bp--loaded")}}generatePairsFromDOM(){const e={},t=[];let n;const i=[...this.children].find(e=>e.hasAttribute("origin")),a=e=>{return e.filter(e=>e instanceof Text&&""!==e.data.trim()||e instanceof HTMLElement).reduce((e,t)=>{if(t instanceof Text){let n=c(t.data);const i=[];for(;p(n);)i.push(n.head),n=n.tail;return e.concat(i)}return e.push(t),e},[])},o=(e,n,i)=>{if(i.hasAttribute("ref")&&""!==i.getAttribute("ref"))return t.push([e,n]),i.getAttribute("ref");if(i.hasAttribute("value")&&""!==i.getAttribute("value"))return i.getAttribute("value");{const e=a([...i.childNodes]);if(e.length>0){let t=e[0];return"string"==typeof t||p(t)?t:"EMPTY"===t.tagName?null:"PAIR"===t.tagName?l(t):"LIST"===t.tagName?s(t):null}return null}},l=t=>{let n=new u(null,null);t.hasAttribute("name")&&""!==t.getAttribute("name")&&(e[t.getAttribute("name")]=n);const i=a([...t.childNodes]);if(i.length>0){let e=i[0];"string"==typeof e||p(e)?n.head=e:"BOX"===e.tagName?n.head=o(n,"head",e):"EMPTY"===e.tagName?n.head=null:"PAIR"===e.tagName?n.head=l(e):"LIST"===e.tagName?n.head=s(e):console.error(`Expected text, box, pair, list, or empty, intead got ${e.tagName.toLowerCase()}`)}if(i.length>1){let e=i[1];"string"==typeof e||p(e)?n.tail=e:"BOX"===e.tagName?n.tail=o(n,"tail",e):"EMPTY"===e.tagName?n.tail=null:"PAIR"===e.tagName?n.tail=l(e):"LIST"===e.tagName?n.tail=s(e):console.error(`Expected text, box, pair, list, or empty, intead got ${e.tagName.toLowerCase()}`);for(let e of i.slice(2))e instanceof HTMLElement&&("PAIR"===e.tagName||"LIST"===e.tagName)&&l(e)}return n},s=t=>{const n=new u(null,null);let i=n;t.hasAttribute("name")&&""!==t.getAttribute("name")&&(e[t.getAttribute("name")]=i);const r=t.hasAttribute("explicit-tail"),d=a([...t.childNodes]),c=d.length-(r?2:1);for(const e of d.slice(0,c+1))"string"==typeof e||p(e)?i.head=e:"BOX"===e.tagName?i.head=o(i,"head",e):"EMPTY"===e.tagName?i.head=null:"PAIR"===e.tagName?i.head=l(e):"LIST"===e.tagName?i.head=s(e):console.error(`Expected text, box, pair, list, or empty, intead got ${e.tagName.toLowerCase()}`),e!==d[c]&&(i.tail=new u(null,null),i=i.tail);if(r){const e=d[d.length-1];e instanceof Text?i.tail=e.data.trim():"string"==typeof e||p(e)?i.tail=e:"BOX"===e.tagName?i.tail=o(i,"tail",e):"EMPTY"===e.tagName?i.tail=null:"PAIR"===e.tagName?i.tail=l(e):"LIST"===e.tagName?i.tail=s(e):console.error(`Expected text, box, pair, list, or empty, intead got ${e.tagName.toLowerCase()}`)}return n};for(const e of a([...this.childNodes]))if("string"==typeof e)console.error(`Expected pair or list, intead got ${e}`);else if(p(e))n||i||(n=e);else if("PAIR"===e.tagName||"LIST"===e.tagName){let t;t="PAIR"===e.tagName?l(e):s(e),n||i&&!e.hasAttribute("origin")||(n=t)}else console.error(`Expected pair or list, intead got ${e.tagName.toLowerCase()}`);for(let n of t)n[0][n[1]]=e[n[0][n[1]]]||null;return void 0===n&&(n=new u(null,null)),n}renderDiagram(e,t,n,i,a){if(e&&this.visited.includes(i))return void this.arrowBindings.push([e,this._visitedElements[this.visited.indexOf(i)],"unknown"]);this.visited.push(i);const o=t[n];for(let e of a){let t=e.cloneNode(!0);t.style.visibility="hidden",o.appendChild(t)}const l=o.children.length,s=document.createElement("div"),r=document.createElement("div");this._visitedElements.push(r),e&&this.arrowBindings.push([e,r,o===e.parentElement.parentElement?"Left":"Top"]);const d=document.createElement("div");if(s.classList.add("bp--pair"),r.classList.add("bp--box"),d.classList.add("bp--box"),s.appendChild(r),s.appendChild(d),o.appendChild(s),p(i.tail));else if(null==i.tail)this.slashes.push(d);else{const e=document.createElement("span");e.innerText=i.tail,d.appendChild(e)}if(p(i.head));else if(null==i.head)this.slashes.push(r);else{const e=document.createElement("span");e.innerText=i.head,r.appendChild(e)}if(p(i.tail)&&this.renderDiagram(d,t,n,i.tail,[]),p(i.head)){const e=t.push(document.createElement("div"))-1;t[e].classList.add("bp--row"),this.renderDiagram(r,t,e,i.head,[...o.children].slice(0,l))}}})}]);